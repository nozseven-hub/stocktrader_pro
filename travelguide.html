<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>Lyon Travel Guide ‚Äî Great App (with Routes)</title>

<!-- Leaflet & Awesome Markers & Font Awesome -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

<style>
  html, body {height:100%; margin:0; padding:0; font-family: system-ui, -apple-system, Arial, sans-serif;}
  .tabs {display:flex; background:#222; color:#fff;}
  .tab {flex:1; text-align:center; padding:12px; cursor:pointer;}
  .tab.active {background:#444; font-weight:600;}
  .tab-content {display:none;}
  .tab-content.active {display:block;}
  #map {height:80vh; position:relative;}

  /* Toggles */
  .toggle-btn{position:absolute; z-index:1100; right:10px;
    background:#fff; border:1px solid #d9d9d9; border-radius:999px;
    padding:8px 12px; font-size:14px; box-shadow:0 2px 8px rgba(0,0,0,0.12);}
  #filtersToggle{top:60px;}
  #legendToggle{bottom:10px;}
  .panel{position:absolute; z-index:1099; right:10px; width:240px;
    background:rgba(255,255,255,0.96); border:1px solid #e5e5e5; border-radius:10px;
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    overflow:hidden; max-height:0; opacity:0; pointer-events:none;
    transition: max-height 280ms ease, opacity 220ms ease;}
  .panel.open{max-height:520px; opacity:1; pointer-events:auto;}
  .filters-panel{top:100px; padding:10px;}
  .filters-panel label{display:block; margin:6px 0 2px; font-weight:600; font-size:13px;}
  .filters-panel select, .filters-panel button{width:100%; padding:6px; font-size:14px; margin-bottom:6px;}
  .filters-panel button{border:1px solid #bbb; border-radius:6px; background:#f5f5f5;}
  .legend-panel{bottom:50px; padding:10px; font-size:13px; line-height:18px; color:#333;}
  .legend-title{font-weight:700; margin-bottom:6px;}
  .dot{display:inline-block; width:14px; height:14px; border-radius:50%; margin-right:6px; vertical-align:middle;}
  .legend-section{margin-bottom:8px; padding-bottom:6px; border-bottom:1px dashed #e6e6e6;}

  /* Plan tab */
  #plan {padding:12px; max-width:1000px; margin:0 auto;}
  .day-section{background:#fafafa; border:1px solid #eee; border-radius:10px; padding:12px; margin:10px 0;}
  .day-title{margin:0 0 10px; padding-bottom:6px; border-bottom:1px dashed #ddd; font-size:18px}
  .poi{margin:10px 0;}
  .poi .name{font-weight:600; display:flex; align-items:center; justify-content:space-between;}
  .poi .name .openmaps{font-size:12px; background:#eee; border-radius:6px; padding:2px 6px;}
  .meta{color:#555; font-size:13px;}
  .links a{color:#0366d6; text-decoration:none; margin-right:8px;}
  .badge{display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#efefef; margin-left:6px;}
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-tab="mapTab">Map</div>
  <div class="tab" data-tab="planTab">Plan</div>
</div>

<!-- MAP TAB -->
<div id="mapTab" class="tab-content active">
  <div id="map">
    <button id="filtersToggle" class="toggle-btn">‚öôÔ∏è Filters</button>
    <button id="legendToggle" class="toggle-btn">üìñ Legend</button>

    <div id="filtersPanel" class="panel filters-panel">
      <label>Plan</label>
      <select id="planSelect">
        <option value="A">Plan A (Lyon + Beaujolais)</option>
        <option value="B">Plan B (Lyon only)</option>
      </select>
      <label>Day</label>
      <select id="daySelect">
        <option value="all">All Days</option>
        <option value="day1">Day 1</option>
        <option value="day2">Day 2</option>
        <option value="day3">Day 3</option>
        <option value="day4">Day 4</option>
        <option value="day5">Day 5</option>
      </select>
      <label>Category</label>
      <select id="catSelect">
        <option value="all">All Categories</option>
        <option value="sight">Sights</option>
        <option value="museum">Museums</option>
        <option value="church">Churches</option>
        <option value="market">Markets</option>
        <option value="restaurant">Restaurants</option>
        <option value="wine">Wine/Wineries</option>
        <option value="home">Home</option>
      </select>
      <button id="clearFilters">Clear All Filters</button>
    </div>

    <div id="legendPanel" class="panel legend-panel">
      <div class="legend-title">Legend</div>
      <div class="legend-section">
        <div><span class="dot" style="background:#d9534f"></span> Day 1</div>
        <div><span class="dot" style="background:#0275d8"></span> Day 2</div>
        <div><span class="dot" style="background:#5cb85c"></span> Day 3</div>
        <div><span class="dot" style="background:#f0ad4e"></span> Day 4</div>
        <div><span class="dot" style="background:#613d7c"></span> Day 5</div>
      </div>
      <div>
        üçΩÔ∏è Restaurant<br/> üõçÔ∏è Market<br/> üñºÔ∏è Museum<br/> ‚õ™ Church<br/> üó∫Ô∏è Sights<br/> üç∑ Wine<br/> üè† Home
      </div>
    </div>
  </div>
</div>

<!-- PLAN TAB -->
<div id="planTab" class="tab-content">
  <div id="plan">
    <h3>Trip Plan</h3>
    <div id="planDetails"></div>
  </div>
</div>

<script>
/* ===================== Tabs ===================== */
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
    if(tab.dataset.tab==="mapTab"){ setTimeout(()=>map.invalidateSize(), 120); }
  });
});

/* ===================== Map ===================== */
const map=L.map("map",{center:[45.764,4.8357],zoom:13});
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap"}).addTo(map);

/* Toggles (hidden by default) */
document.getElementById("filtersToggle").onclick=()=>document.getElementById("filtersPanel").classList.toggle("open");
document.getElementById("legendToggle").onclick =()=>document.getElementById("legendPanel").classList.toggle("open");

/* ===================== Colors & Icons ===================== */
const dayColors={day1:"#d9534f",day2:"#0275d8",day3:"#5cb85c",day4:"#f0ad4e",day5:"#613d7c"};
const colorMap={"#d9534f":"red","#0275d8":"blue","#5cb85c":"green","#f0ad4e":"orange","#613d7c":"purple"};
const catIconNames={sight:"fa-eye",museum:"fa-university",church:"fa-institution",restaurant:"fa-cutlery",market:"fa-shopping-cart",wine:"fa-glass",home:"fa-home"};
function getIcon(cat,day){
  if(cat==="home"){return L.AwesomeMarkers.icon({icon:"fa-home",markerColor:"black",prefix:"fa",iconColor:"white"});}
  return L.AwesomeMarkers.icon({icon:catIconNames[cat]||"fa-map-marker",markerColor:colorMap[dayColors[day]]||"cadetblue",prefix:"fa",iconColor:"white"});
}

/* ===================== Helpers ===================== */
function P(lat,lng,name,cat,opts={}){return Object.assign({lat,lng,name,cat},opts);}
function navLinks(lat,lng){return {g:`https://www.google.com/maps/search/?api=1&query=${lat},${lng}`,a:`http://maps.apple.com/?daddr=${lat},${lng}`};}
function popupHTML(p,day){
  const n=navLinks(p.lat,p.lng);
  return `<b>${p.name}</b>${day&&day.startsWith("day")?`<br>Day ${day.replace("day","")}`:""}
          ${p.dur?`<br>‚è± ${p.dur}`:""}
          ${p.notes?`<br>${p.notes}`:""}
          ${p.phone?`<br>‚òé <a href="tel:${p.phone}">${p.phone}</a>`:""}
          ${p.website?`<br>üåê <a href="${p.website}" target="_blank">Website</a>`:""}
          ${p.instagram?`<br>üì∏ <a href="${p.instagram}" target="_blank">Instagram</a>`:""}
          <br>üß≠ <a href="${n.g}" target="_blank">Google Maps</a> | <a href="${n.a}" target="_blank">Apple Maps</a>`;
}

/* ===================== Home ===================== */
const HOME={lat:45.77099,lng:4.83384,name:"Home: 12 Rue Burdeau, 69001 Lyon",cat:"home"};

/* ===================== Reusable POIs ===================== */
const POI={
  // Sights & areas
  vieuxLyon: P(45.7629,4.8270,"Vieux Lyon (Old Town)","sight",{dur:"1.5‚Äì2h",notes:"Renaissance alleys & traboules"}),
  traboules: P(45.7613,4.8347,"Traboules (self-guided)","sight",{dur:"45‚Äì60min",notes:"Historic covered passages"}),
  terreaux:  P(45.7678,4.8343,"Place des Terreaux & H√¥tel de Ville","sight",{dur:"20min",notes:"Bartholdi Fountain"}),
  opera:     P(45.7670,4.8356,"Op√©ra de Lyon (exterior)","sight",{dur:"15‚Äì20min",website:"https://www.opera-lyon.com"}),
  bellecour: P(45.7570,4.8320,"Place Bellecour","sight",{dur:"20min"}),
  rueRepub:  P(45.7610,4.8355,"Rue de la R√©publique stroll","sight",{dur:"45min"}),
  merciere:  P(45.7628,4.8333,"Rue Merci√®re caf√©s","sight",{dur:"30‚Äì45min"}),
  murCanuts: P(45.7792,4.8278,"Mur des Canuts (trompe-l‚Äô≈ìil)","sight",{dur:"20min"}),
  belvedere: P(45.7625,4.8228,"Fourvi√®re belvedere (panorama)","sight",{dur:"15‚Äì20min"}),
  confluenceWalk:P(45.7336,4.8207,"Confluence waterfront walk","sight",{dur:"45‚Äì60min"}),
  saoneQuays:P(45.7632,4.8279,"Sa√¥ne riverside walk","sight",{dur:"30‚Äì45min"}),
  teteDor:   P(45.7772,4.8520,"Parc de la T√™te d‚ÄôOr (lake & gardens)","sight",{dur:"1.5‚Äì2h",website:"https://www.lyon.fr/lieu/parc-de-la-tete-dor"}),

  // Churches
  fourviere: P(45.7622,4.8229,"Basilica of Notre-Dame de Fourvi√®re","church",{dur:"1‚Äì1.5h",notes:"Free entry; panoramic view",website:"https://fourviere.org"}),
  cathedral: P(45.7576,4.8241,"Cath√©drale Saint-Jean-Baptiste","church",{dur:"30‚Äì45min"}),

  // Museums
  mba:       P(45.7673,4.8346,"Mus√©e des Beaux-Arts de Lyon","museum",{dur:"2h",notes:"Book tickets online",website:"https://mba-lyon.fr",phone:"+33 4 72 10 17 40"}),
  gadagne:   P(45.7625,4.8272,"Mus√©es Gadagne (History & Puppetry)","museum",{dur:"1.5‚Äì2h",notes:"Consider tickets in advance",website:"https://musees-gadagne.fr"}),
  tissus:    P(45.7559,4.8322,"Mus√©e des Tissus et des Arts D√©coratifs","museum",{dur:"1.5‚Äì2h",website:"https://www.museedestissus.fr"}),
  confluences:P(45.7331,4.8196,"Mus√©e des Confluences","museum",{dur:"2‚Äì2.5h",notes:"Book online; striking architecture",website:"https://www.museedesconfluences.fr"}),
  lugdunum:  P(45.7584,4.8188,"Lugdunum (Roman Theatres & Museum)","museum",{dur:"1.5‚Äì2h",website:"https://lugdunum.grandlyon.com"}),
  lumiere:   P(45.7458,4.8725,"Institut Lumi√®re (cinema museum)","museum",{dur:"1.5h",website:"https://www.institut-lumiere.org"}),

  // Markets
  halles:    P(45.7634,4.8597,"Les Halles de Lyon Paul Bocuse","market",{dur:"1.5h",notes:"Oysters/charcuterie stops",website:"https://halles-de-lyon-paulbocuse.com"}),
  croixMarket:P(45.7761,4.8272,"Croix-Rousse Market","market",{dur:"1‚Äì1.5h"}),
  stAntoine: P(45.7606,4.8326,"March√© Saint-Antoine (riverside)","market",{dur:"1h",notes:"Morning farmers‚Äô market"}),

  // Restaurants (bouchons & brasseries)
  bouchonFilles: P(45.7692,4.8344,"Le Bouchon des Filles","restaurant",{dur:"1.5‚Äì2h dinner",notes:"Reservation recommended",phone:"+33 4 78 29 33 63",website:"https://bouchondesfilles.fr",instagram:"https://instagram.com/lebouchondesfilles"}),
  comptoirAbel:  P(45.7477,4.8269,"Caf√© Comptoir Abel","restaurant",{dur:"1.5‚Äì2h dinner",notes:"Reserve ahead",phone:"+33 4 78 37 46 18"}),
  poelonDor:     P(45.7515,4.8288,"Le Po√™lon d‚ÄôOr","restaurant",{dur:"1.5‚Äì2h dinner",notes:"Traditional bouchon; book",phone:"+33 4 78 37 65 60",website:"https://lepoelondor.fr"}),
  lesAdrets:     P(45.7616,4.8265,"Les Adrets","restaurant",{dur:"1.5‚Äì2h",notes:"Traditional bouchon; reserve",phone:"+33 4 78 38 24 30",website:"http://www.lesadrets-lyon.fr"}),
  bouchonTupin:  P(45.7621,4.8336,"Bouchon Tupin","restaurant",{dur:"1.5‚Äì2h",notes:"Reserve ahead",phone:"+33 4 78 28 62 72",instagram:"https://instagram.com/bouchontupin"}),
  brasserieGeorges:P(45.7482,4.8258,"Brasserie Georges","restaurant",{dur:"1.5‚Äì2h",notes:"Historic brasserie; book",phone:"+33 4 72 56 54 54",website:"https://brasseriegeorges.com",instagram:"https://instagram.com/brasseriegeorges"}),
  brasserieBrotteaux:P(45.7646,4.8597,"Brasserie des Brotteaux","restaurant",{dur:"1.5‚Äì2h",notes:"Art nouveau setting; reserve",phone:"+33 4 78 54 17 23",website:"https://brasseriedesbrotteaux.com"}),
  prairial:      P(45.7673,4.8346,"Prairial (Michelin ‚òÖ)","restaurant",{dur:"2‚Äì2.5h",notes:"Reserve well ahead",phone:"+33 4 72 60 00 42",website:"https://prairial-restaurant.com",instagram:"https://www.instagram.com/prairialrestaurant"}),
  neuviemeArt:   P(45.7701,4.8502,"Le Neuvi√®me Art (Michelin ‚òÖ‚òÖ)","restaurant",{dur:"2.5h",notes:"Reserve far in advance",website:"https://www.leneuviemeart.com"}),
  chezPaul:      P(45.7685,4.8363,"Chez Paul (casual lunch)","restaurant",{dur:"45‚Äì60min",phone:"+33 4 78 92 19 61"}),
  pignol:        P(45.7644,4.8367,"Pignol (light lunch/pastry)","restaurant",{dur:"45‚Äì60min",phone:"+33 4 78 42 30 36",website:"https://www.pignol.fr"}),

  // Wine bars / cavistes in Lyon
  anticWine:     P(45.7626,4.8274,"Antic Wine (caviste)","wine",{dur:"30‚Äì45min",website:"https://anticwine.fr"}),
  caveACote:     P(45.7613,4.8347,"La Cave d‚Äô√† C√¥t√©","wine",{dur:"45‚Äì60min"}),
  leBallon:      P(45.7744,4.8275,"Le Ballon (wine bar)","wine",{dur:"1h"}),

  // Beaujolais wineries
  pizay:         P(46.2030,4.7060,"Ch√¢teau de Pizay (Beaujolais)","wine",{dur:"1.5‚Äì2h tasting",notes:"Reservation required",website:"https://chateau-pizay.com",phone:"+33 4 74 66 26 10"}),
  nugues:        P(46.2078,4.7139,"Domaine des Nugues","wine",{dur:"1‚Äì1.5h tasting",notes:"Book ahead",website:"https://domainedesnugues.com"}),
  jeanLoron:     P(46.2445,4.7472,"Maison Jean Loron","wine",{dur:"1‚Äì1.5h tasting",notes:"Book ahead",website:"https://www.jeanloron.com"})
};

/* ===================== Plans ===================== */
const PlanA={ // Lyon + Beaujolais
  day1:[POI.vieuxLyon,POI.traboules,POI.cathedral,POI.fourviere,POI.terreaux,POI.mba,POI.bouchonFilles],
  day2:[POI.croixMarket,POI.murCanuts,POI.halles,POI.anticWine,POI.brasserieGeorges],
  day3:[POI.lugdunum,POI.gadagne,POI.opera,POI.rueRepub,POI.prairial],
  day4:[POI.pizay,POI.nugues,POI.jeanLoron], // Beaujolais
  day5:[Object.assign({},POI.teteDor,{notes:"Relaxing stroll ‚Ä¢ finish by ~13:30"}),Object.assign({},POI.pignol,{name:"Pignol (early lunch)"})]
};

const PlanB={ // Lyon only (more city depth)
  day1:[POI.vieuxLyon,POI.traboules,POI.cathedral,POI.fourviere,POI.terreaux,POI.mba,POI.bouchonFilles],
  day2:[POI.croixMarket,POI.murCanuts,POI.halles,POI.anticWine,POI.brasserieGeorges],
  day3:[POI.lugdunum,POI.gadagne,POI.tissus,POI.confluences,POI.confluenceWalk,POI.brasserieBrotteaux],
  day4:[POI.bellecour,POI.rueRepub,POI.merciere,POI.opera,POI.lumiere,POI.neuviemeArt],
  day5:[Object.assign({},POI.teteDor,{notes:"Relaxing stroll ‚Ä¢ finish by ~13:30"}),Object.assign({},POI.chezPaul,{name:"Chez Paul (early lunch)"})]
};

const plans={A:PlanA,B:PlanB};

/* ===================== Routes Layer ===================== */
let currentPlan="A",currentDay="all",currentCat="all",markers=[];
let routeLayer=null;    // polyline
let dotLayer=null;      // small dots at each stop

function clearOverlays(){
  if(routeLayer){ map.removeLayer(routeLayer); routeLayer=null; }
  if(dotLayer){ map.removeLayer(dotLayer); dotLayer=null; }
}

function clearMarkers(){ markers.forEach(m=>map.removeLayer(m)); markers=[]; }

function addHome(){
  const hm=L.marker([HOME.lat,HOME.lng],{icon:getIcon("home","day1")})
    .addTo(map)
    .bindPopup(popupHTML(HOME,""));
  markers.push(hm);
}

function drawRouteForDay(coords){
  if(coords.length<2) return;
  // Polyline (dashed red)
  routeLayer=L.polyline(coords,{
    color:"red", weight:3, opacity:0.9, dashArray:"6,6", lineCap:"round", lineJoin:"round"
  }).addTo(map);
  // Dots at each stop
  dotLayer=L.layerGroup(coords.map(c=>L.circleMarker(c,{
    radius:4, color:"red", fillColor:"red", fillOpacity:0.9, weight:1
  }))).addTo(map);
}

/* ===================== Render ===================== */
function refreshMap(){
  clearMarkers(); clearOverlays(); addHome();

  const plan=plans[currentPlan];
  const boundsPoints=[[HOME.lat,HOME.lng]];
  let routeCoords=[];

  for(const dayKey in plan){
    if(currentDay!=="all" && currentDay!==dayKey) continue;

    plan[dayKey].forEach(p=>{
      if(currentCat!=="all" && currentCat!==p.cat) return;
      const marker=L.marker([p.lat,p.lng],{icon:getIcon(p.cat,dayKey)}).addTo(map).bindPopup(popupHTML(p,dayKey));
      markers.push(marker);
      boundsPoints.push([p.lat,p.lng]);

      // If a single day is selected, collect coords in order for route
      if(currentDay!=="all"){ routeCoords.push([p.lat,p.lng]); }
    });
  }

  if(boundsPoints.length>1){
    const group=L.featureGroup(markers);
    map.fitBounds(group.getBounds().pad(0.2));
  }

  // Draw route only when a single day is selected
  if(currentDay!=="all" && routeCoords.length>1){
    drawRouteForDay(routeCoords);
  }

  renderPlanText();
}

function renderPlanText(){
  const plan=plans[currentPlan];
  const c=document.getElementById("planDetails"); c.innerHTML="";
  for(const dayKey of ["day1","day2","day3","day4","day5"]){
    if(!plan[dayKey]) continue;
    if(currentDay!=="all" && currentDay!==dayKey) continue;

    const dayDiv=document.createElement("div"); dayDiv.className="day-section";
    dayDiv.innerHTML=`<h4 class="day-title">Day ${dayKey.replace("day","")}</h4>`;
    let prev=null;
    plan[dayKey].forEach(p=>{
      if(currentCat!=="all" && currentCat!==p.cat) return;
      const n=navLinks(p.lat,p.lng);
      // simple walk heuristic for city days (kept for quick context)
      let walkHint="";
      const isWineryDay=(currentPlan==="A" && dayKey==="day4");
      if(prev && !isWineryDay){ walkHint=" ‚Ä¢ üö∂ 10‚Äì20 min walk (est.)"; }
      const item=document.createElement("div"); item.className="poi";
      item.innerHTML=`
        <div class="name">${p.name}
          <span style="display:flex;gap:8px;align-items:center;">
            <span class="badge">${p.cat}</span>
            <a class="openmaps" href="${n.g}" target="_blank">üß≠ Open</a>
          </span>
        </div>
        <div class="meta">
          ${p.dur?`‚è± ${p.dur}`:""} ${p.notes?`‚Ä¢ ${p.notes}`:""}${walkHint}
        </div>
        <div class="links">
          ${p.phone?`‚òé <a href="tel:${p.phone}">${p.phone}</a>`:""}
          ${p.website?`üåê <a href="${p.website}" target="_blank">Website</a>`:""}
          ${p.instagram?`üì∏ <a href="${p.instagram}" target="_blank">Instagram</a>`:""}
          üß≠ <a href="${n.g}" target="_blank">Google Maps</a> | <a href="${n.a}" target="_blank">Apple Maps</a>
        </div>`;
      dayDiv.appendChild(item); prev=p;
    });
    c.appendChild(dayDiv);
  }
}

/* ===================== Filters ===================== */
document.getElementById("planSelect").onchange=e=>{currentPlan=e.target.value;refreshMap();};
document.getElementById("daySelect").onchange =e=>{currentDay =e.target.value;refreshMap();};
document.getElementById("catSelect").onchange =e=>{currentCat =e.target.value;refreshMap();};
document.getElementById("clearFilters").onclick=()=>{
  currentPlan="A"; currentDay="all"; currentCat="all";
  document.getElementById("planSelect").value="A";
  document.getElementById("daySelect").value="all";
  document.getElementById("catSelect").value="all";
  refreshMap();
};

/* ===================== Init ===================== */
refreshMap();
</script>

</body>
</html>
