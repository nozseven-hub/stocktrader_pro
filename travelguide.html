<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>Lyon Travel Guide</title>

<!-- Leaflet & Awesome Markers & Font Awesome -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>

<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

<style>
  html, body {height:100%; margin:0; padding:0; font-family: system-ui, -apple-system, Arial, sans-serif;}
  /* Tabs */
  .tabs {display:flex; background:#222; color:#fff;}
  .tab {flex:1; text-align:center; padding:12px; cursor:pointer; user-select:none;}
  .tab.active {background:#444; font-weight:600;}
  .tab-content {display:none;}
  .tab-content.active {display:block;}
  /* Map */
  #map {height:80vh; position:relative;}
  /* Toggle buttons */
  .toggle-btn{
    position:absolute; z-index:1100; right:10px;
    background:#ffffff; border:1px solid #d9d9d9; border-radius:999px;
    padding:8px 12px; font-size:14px; box-shadow:0 2px 8px rgba(0,0,0,0.12);
  }
  #filtersToggle{top:60px;}
  #legendToggle{bottom:10px;}
  /* Panels (hidden by default) */
  .panel{
    position:absolute; z-index:1099; right:10px; width: 190px;
    background:rgba(255,255,255,0.96); border:1px solid #e5e5e5; border-radius:10px;
    box-shadow:0 8px 20px rgba(0,0,0,0.15); backdrop-filter: blur(2px);
    overflow:hidden; max-height:0; opacity:0; pointer-events:none;
    transition: max-height 280ms ease, opacity 220ms ease;
  }
  .panel.open{max-height: 380px; opacity:1; pointer-events:auto;}
  /* Filters panel content */
  .filters-panel{top:100px; padding:10px;}
  .filters-panel label{display:block; margin:6px 0 2px; font-weight:600; font-size:13px;}
  .filters-panel select, .filters-panel button{width:100%; padding:6px; font-size:14px; margin-bottom:6px;}
  .filters-panel button{border:1px solid #bbb; border-radius:6px; background:#f5f5f5;}
  .filters-panel button:active{background:#ececec;}
  /* Legend panel content */
  .legend-panel{bottom:50px; padding:10px; font-size:13px; line-height:18px; color:#333;}
  .legend-title{font-weight:700; margin-bottom:6px;}
  .dot{display:inline-block; width:14px; height:14px; border-radius:50%; margin-right:6px; vertical-align:middle;}
  .legend-section{margin-bottom:8px; padding-bottom:6px; border-bottom:1px dashed #e6e6e6;}
  /* Plan tab */
  #plan {padding:12px; max-width:1000px; margin:0 auto;}
  #plan h3 {margin-top:4px;}
  .day-section{background:#fafafa; border:1px solid #eee; border-radius:10px; padding:12px; margin:10px 0;}
  .day-title{margin:0 0 10px; padding-bottom:6px; border-bottom:1px dashed #ddd; font-size:18px}
  .poi{margin:10px 0;}
  .poi .name{font-weight:600;}
  .meta{color:#555; font-size:13px;}
  .links a{color:#0366d6; text-decoration:none; margin-right:8px;}
  .links a:hover{text-decoration:underline;}
  .badge{display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#efefef; margin-left:6px;}
  .cat-emoji{margin-right:6px;}
  @media (max-width:420px){
    #filtersToggle{top:64px;}
    .filters-panel{top:104px;}
  }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-tab="mapTab">Map</div>
  <div class="tab" data-tab="planTab">Plan</div>
</div>

<!-- MAP TAB -->
<div id="mapTab" class="tab-content active">
  <div id="map">
    <!-- Toggle buttons -->
    <button id="filtersToggle" class="toggle-btn">‚öôÔ∏è Filters</button>
    <button id="legendToggle" class="toggle-btn">üìñ Legend</button>

    <!-- Filters panel (hidden by default) -->
    <div id="filtersPanel" class="panel filters-panel">
      <label>Plan</label>
      <select id="planSelect">
        <option value="A">Plan A (Lyon + Beaujolais)</option>
        <option value="B">Plan B (Lyon only)</option>
      </select>

      <label>Day</label>
      <select id="daySelect">
        <option value="all">All Days</option>
        <option value="day1">Day 1</option>
        <option value="day2">Day 2</option>
        <option value="day3">Day 3</option>
        <option value="day4">Day 4</option>
        <option value="day5">Day 5</option>
      </select>

      <label>Category</label>
      <select id="catSelect">
        <option value="all">All Categories</option>
        <option value="sight">Sights</option>
        <option value="museum">Museums</option>
        <option value="church">Churches</option>
        <option value="market">Markets</option>
        <option value="restaurant">Restaurants</option>
        <option value="wine">Wine/Wineries</option>
        <option value="home">Home</option>
      </select>

      <button id="clearFilters">Clear All Filters</button>
    </div>

    <!-- Legend panel (hidden by default) -->
    <div id="legendPanel" class="panel legend-panel">
      <div class="legend-title">Legend</div>
      <div class="legend-section">
        <div><span class="dot" style="background:#d9534f"></span> Day 1</div>
        <div><span class="dot" style="background:#0275d8"></span> Day 2</div>
        <div><span class="dot" style="background:#5cb85c"></span> Day 3</div>
        <div><span class="dot" style="background:#f0ad4e"></span> Day 4</div>
        <div><span class="dot" style="background:#613d7c"></span> Day 5</div>
      </div>
      <div>
        üçΩÔ∏è Restaurant<br/>
        üõçÔ∏è Market / Food Hall<br/>
        üñºÔ∏è Museum<br/>
        ‚õ™ Church / Cathedral<br/>
        üó∫Ô∏è Sights / Walks<br/>
        üç∑ Winery / Tasting<br/>
        üè† Home
      </div>
    </div>
  </div>
</div>

<!-- PLAN TAB -->
<div id="planTab" class="tab-content">
  <div id="plan">
    <h3>Trip Plan</h3>
    <div id="planDetails"></div>
  </div>
</div>

<script>
/* ---------- Tabs ---------- */
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".tab-content").forEach(c=>c.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.add("active");
    // Invalidate map when returning to map tab
    if(tab.dataset.tab === "mapTab"){ setTimeout(()=>map.invalidateSize(), 100); }
  });
});

/* ---------- Map ---------- */
const map = L.map("map", {center:[45.764, 4.8357], zoom:13});
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {attribution:"¬© OpenStreetMap"}).addTo(map);

/* Toggle panels */
const filtersToggle = document.getElementById("filtersToggle");
const legendToggle  = document.getElementById("legendToggle");
const filtersPanel  = document.getElementById("filtersPanel");
const legendPanel   = document.getElementById("legendPanel");

filtersToggle.addEventListener("click", ()=>{
  filtersPanel.classList.toggle("open");
  setTimeout(()=>map.invalidateSize(), 280);
});
legendToggle.addEventListener("click", ()=>{
  legendPanel.classList.toggle("open");
  setTimeout(()=>map.invalidateSize(), 280);
});

/* Day colors + category icons */
const dayColors = {day1:"#d9534f", day2:"#0275d8", day3:"#5cb85c", day4:"#f0ad4e", day5:"#613d7c"};
const catIconNames = {
  sight:"fa-eye",
  museum:"fa-university",
  church:"fa-institution",
  restaurant:"fa-cutlery",
  market:"fa-shopping-cart",
  wine:"fa-glass",
  home:"fa-home"
};
function getIcon(category, day){
  // Map markerColor to leaflet-awesome-markers presets (rough matches)
  const colorMap = { "#d9534f":"red", "#0275d8":"blue", "#5cb85c":"green", "#f0ad4e":"orange", "#613d7c":"purple" };
  const markerColor = colorMap[dayColors[day]] || "cadetblue";
  return L.AwesomeMarkers.icon({
    icon: catIconNames[category] || "fa-map-marker",
    markerColor,
    prefix:"fa",
    iconColor:"white"
  });
}
const catEmoji = {sight:"üó∫Ô∏è", museum:"üñºÔ∏è", church:"‚õ™", restaurant:"üçΩÔ∏è", market:"üõçÔ∏è", wine:"üç∑", home:"üè†"};

/* ---------- DATA ---------- */
/* Home */
const HOME = {lat:45.7703, lng:4.8328, name:"Home: 12 Rue Burdeau, 69001 Lyon", cat:"home"};

/* Helper */
function P(lat,lng,name,cat,opts={}){return Object.assign({lat,lng,name,cat},opts);}

/* Plan A (Lyon + Beaujolais) ‚Äî 5 days */
const PlanA = {
  day1: [
    P(45.7629,4.8270,"Vieux Lyon (Old Town)","sight",{notes:"Explore Renaissance streets & traboules", dur:"1.5h"}),
    P(45.7673,4.8346,"Mus√©e des Beaux-Arts de Lyon","museum",{notes:"Book tickets online", dur:"2h", website:"https://mba-lyon.fr", phone:"+33 4 72 10 17 40"}),
    P(45.7678,4.8343,"Place des Terreaux & H√¥tel de Ville","sight",{notes:"Photo stop", dur:"20min"}),
    P(45.7638,4.8345,"Le Bouchon des Filles","restaurant",{notes:"Reservation recommended", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 78 29 33 63", website:"https://bouchondesfilles.fr", instagram:"https://instagram.com/lebouchondesfilles"})
  ],
  day2: [
    P(45.7761,4.8272,"Croix-Rousse Market (Bd de la Croix-Rousse)","market",{notes:"Morning market, produce & snacks", dur:"1‚Äì1.5h"}),
    P(45.7792,4.8278,"Mur des Canuts (Fresco)","sight",{notes:"Iconic trompe-l‚Äôoeil mural", dur:"20min"}),
    P(45.7634,4.8597,"Les Halles de Lyon Paul Bocuse","market",{notes:"Food hall tastings", dur:"1.5h", website:"https://halles-de-lyon-paulbocuse.com"}),
    P(45.7482,4.8258,"Brasserie Georges","restaurant",{notes:"Book table (popular)", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 72 56 54 54", website:"https://brasseriegeorges.com", instagram:"https://instagram.com/brasseriegeorges"})
  ],
  day3: [
    P(45.7622,4.8229,"Basilica of Notre-Dame de Fourvi√®re","church",{notes:"Free entry; panoramic views", dur:"1‚Äì1.5h", website:"https://fourviere.org"}),
    P(45.7584,4.8188,"Roman Theatres of Fourvi√®re","sight",{notes:"Archaeology site", dur:"45‚Äì60min", website:"https://lugdunum.grandlyon.com"}),
    P(45.7625,4.8272,"Mus√©e Gadagne (History & Puppetry)","museum",{notes:"Consider advance tickets", dur:"1.5‚Äì2h", website:"https://musees-gadagne.fr"}),
    P(45.7613,4.8347,"Traboules self-guided walk (Presqu‚Äô√Æle/Vieux-Lyon)","sight",{notes:"Historic covered passages", dur:"45‚Äì60min"}),
    P(45.7477,4.8269,"Caf√© Comptoir Abel","restaurant",{notes:"Classic bouchon, reserve ahead", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 78 37 46 18"})
  ],
  day4: [
    P(46.2030,4.7060,"Ch√¢teau de Pizay (Beaujolais)","wine",{notes:"Tasting ‚Äî reservation required", dur:"1.5h", website:"https://chateau-pizay.com", phone:"+33 4 74 66 26 10"}),
    P(46.2078,4.7139,"Domaine des Nugues","wine",{notes:"Tasting ‚Äî book ahead", dur:"1‚Äì1.5h", website:"https://domainedesnugues.com"}),
    P(46.2445,4.7472,"Maison Jean Loron (Museum & Tasting)","wine",{notes:"Tasting ‚Äî book ahead", dur:"1‚Äì1.5h", website:"https://www.jeanloron.com"})
  ],
  day5: [
    P(45.7772,4.8520,"Parc de la T√™te d‚ÄôOr (lake & gardens)","sight",{notes:"Relaxing stroll; finish by ~13:30", dur:"1.5‚Äì2h", website:"https://www.lyon.fr/lieu/parc-de-la-tete-dor"}),
    P(45.7685,4.8363,"Chez Paul (lunch)","restaurant",{notes:"Casual bouchon; aim for early lunch", dur:"45‚Äì60min", phone:"+33 4 78 92 19 61"})
  ]
};

/* Plan B (Lyon only) ‚Äî 5 days, Day 4 packed with more Lyon sights */
const PlanB = {
  day1: [
    P(45.7629,4.8270,"Vieux Lyon (Old Town)","sight",{notes:"Explore Renaissance streets & traboules", dur:"1.5h"}),
    P(45.7673,4.8346,"Mus√©e des Beaux-Arts de Lyon","museum",{notes:"Book tickets online", dur:"2h", website:"https://mba-lyon.fr", phone:"+33 4 72 10 17 40"}),
    P(45.7638,4.8345,"Le Bouchon des Filles","restaurant",{notes:"Reservation recommended", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 78 29 33 63", website:"https://bouchondesfilles.fr", instagram:"https://instagram.com/lebouchondesfilles"})
  ],
  day2: [
    P(45.7761,4.8272,"Croix-Rousse Market","market",{notes:"Morning market, produce & snacks", dur:"1‚Äì1.5h"}),
    P(45.7634,4.8597,"Les Halles de Lyon Paul Bocuse","market",{notes:"Food hall tastings", dur:"1.5h", website:"https://halles-de-lyon-paulbocuse.com"}),
    P(45.7680,4.8357,"Op√©ra de Lyon (exterior)","sight",{notes:"Photo stop by H√¥tel de Ville", dur:"15‚Äì20min"}),
    P(45.7482,4.8258,"Brasserie Georges","restaurant",{notes:"Book table (popular)", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 72 56 54 54", website:"https://brasseriegeorges.com"})
  ],
  day3: [
    P(45.7622,4.8229,"Basilica of Notre-Dame de Fourvi√®re","church",{notes:"Free entry; city views", dur:"1‚Äì1.5h", website:"https://fourviere.org"}),
    P(45.7584,4.8188,"Roman Theatres of Fourvi√®re","sight",{notes:"Archaeology site", dur:"45‚Äì60min", website:"https://lugdunum.grandlyon.com"}),
    P(45.7625,4.8272,"Mus√©e Gadagne (History & Puppetry)","museum",{notes:"Consider advance tickets", dur:"1.5‚Äì2h", website:"https://musees-gadagne.fr"}),
    P(45.7477,4.8269,"Caf√© Comptoir Abel","restaurant",{notes:"Reserve ahead", dur:"Dinner 1.5‚Äì2h", phone:"+33 4 78 37 46 18"})
  ],
  day4: [
    P(45.7331,4.8196,"Mus√©e des Confluences","museum",{notes:"Book online; striking architecture", dur:"2‚Äì2.5h", website:"https://www.museedesconfluences.fr"}),
    P(45.7336,4.8207,"Confluence District (walk)","sight",{notes:"Modern waterfront & shopping", dur:"45‚Äì60min"}),
    P(45.7576,4.8241,"Lyon Cathedral (Saint-Jean)","church",{notes:"Gothic cathedral", dur:"30‚Äì45min"}),
    P(45.7630,4.8357,"Place Bellecour ‚Üí Rue Merci√®re stroll","sight",{notes:"Presqu‚Äô√Æle shopping/food street", dur:"45‚Äì60min"}),
    P(45.7646,4.8597,"Brasserie des Brotteaux","restaurant",{notes:"Dinner; reservation advised", dur:"1.5‚Äì2h", phone:"+33 4 78 54 17 23"})
  ],
  day5: [
    P(45.7772,4.8520,"Parc de la T√™te d‚ÄôOr (lake & gardens)","sight",{notes:"Relaxing stroll; finish by ~13:30", dur:"1.5‚Äì2h", website:"https://www.lyon.fr/lieu/parc-de-la-tete-dor"}),
    P(45.7685,4.8363,"Chez Paul (lunch)","restaurant",{notes:"Casual bouchon; aim for early lunch", dur:"45‚Äì60min", phone:"+33 4 78 92 19 61"})
  ]
};

/* Bundle plans */
const plans = { A: PlanA, B: PlanB };

/* ---------- Rendering ---------- */
let currentPlan = "A";
let currentDay = "all";
let currentCat = "all";
let markers = [];

function clearMarkers(){ markers.forEach(m=>map.removeLayer(m)); markers = []; }
function addHome(){
  const hm = L.marker([HOME.lat, HOME.lng], {icon:getIcon("home","day1")})
    .addTo(map)
    .bindPopup(`<b>${HOME.name}</b>`);
  markers.push(hm);
}

function popupHTML(p, dayKey){
  let h = `<b>${p.name}</b><br>Day ${dayKey.replace("day","")}`;
  if(p.dur)  h += `<br>‚è± ${p.dur}`;
  if(p.notes) h += `<br>${p.notes}`;
  if(p.phone) h += `<br>‚òé <a href="tel:${p.phone}">${p.phone}</a>`;
  if(p.website) h += `<br>üåê <a href="${p.website}" target="_blank">Website</a>`;
  if(p.instagram) h += `<br>üì∏ <a href="${p.instagram}" target="_blank">Instagram</a>`;
  return h;
}

function refreshMap(){
  clearMarkers();
  addHome();
  const plan = plans[currentPlan];

  for(const dayKey in plan){
    if(currentDay !== "all" && currentDay !== dayKey) continue;
    plan[dayKey].forEach(poi=>{
      if(currentCat !== "all" && currentCat !== poi.cat) return;
      const marker = L.marker([poi.lat, poi.lng], {icon: getIcon(poi.cat, dayKey)})
        .addTo(map)
        .bindPopup(popupHTML(poi, dayKey));
      markers.push(marker);
    });
  }
  renderPlanText();
}

function renderPlanText(){
  const plan = plans[currentPlan];
  const container = document.getElementById("planDetails");
  container.innerHTML = "";

  for(const dayKey of ["day1","day2","day3","day4","day5"]){
    if(!plan[dayKey]) continue;
    if(currentDay !== "all" && currentDay !== dayKey) continue;

    const dayDiv = document.createElement("div");
    dayDiv.className = "day-section";
    dayDiv.innerHTML = `<h4 class="day-title">Day ${dayKey.replace("day","")}</h4>`;

    const listDiv = document.createElement("div");
    plan[dayKey].forEach(p=>{
      if(currentCat !== "all" && currentCat !== p.cat) return;
      const item = document.createElement("div");
      item.className = "poi";
      item.innerHTML = `
        <div class="name">${(catEmoji[p.cat]||"")} ${p.name}
          <span class="badge">${p.cat}</span>
        </div>
        <div class="meta">
          ${p.dur ? `‚è± ${p.dur}` : ""}${p.dur && p.notes ? " ‚Ä¢ " : ""}${p.notes || ""}
        </div>
        <div class="links">
          ${p.phone ? `‚òé <a href="tel:${p.phone}">${p.phone}</a>` : ""}
          ${p.website ? `üåê <a href="${p.website}" target="_blank">Website</a>` : ""}
          ${p.instagram ? `üì∏ <a href="${p.instagram}" target="_blank">Instagram</a>` : ""}
        </div>`;
      listDiv.appendChild(item);
    });

    dayDiv.appendChild(listDiv);
    container.appendChild(dayDiv);
  }
}

/* ---------- Selectors ---------- */
document.getElementById("planSelect").addEventListener("change", e=>{
  currentPlan = e.target.value; refreshMap();
});
document.getElementById("daySelect").addEventListener("change", e=>{
  currentDay = e.target.value; refreshMap();
});
document.getElementById("catSelect").addEventListener("change", e=>{
  currentCat = e.target.value; refreshMap();
});
document.getElementById("clearFilters").addEventListener("click", ()=>{
  currentPlan="A"; currentDay="all"; currentCat="all";
  document.getElementById("planSelect").value="A";
  document.getElementById("daySelect").value="all";
  document.getElementById("catSelect").value="all";
  refreshMap();
});

/* ---------- Init ---------- */
refreshMap();
</script>
</body>
</html>
