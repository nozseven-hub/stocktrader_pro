<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Lyon Trip Planner</title>

  <!-- Leaflet + Awesome Markers + FontAwesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>

  <style>
    html, body {margin:0; padding:0; height:100%; font-family:Arial, sans-serif;}
    #map {height:70vh;}
    #plan {height:70vh; overflow-y:auto; padding:10px;}
    .tabs {display:flex; background:#eee;}
    .tabs button {
      flex:1; padding:12px; border:none; background:#ddd;
      font-weight:bold; cursor:pointer;
    }
    .tabs button.active {background:#fff; border-bottom:2px solid #fff;}
    .tabcontent {display:none;}
    .tabcontent.active {display:block;}
    .controls {position:absolute; top:10px; right:10px;
      background:rgba(255,255,255,0.9); padding:10px; border-radius:6px; z-index:1000;}
    .controls select {margin:5px 0; width:160px;}
    .legend {background:white; padding:8px; border-radius:5px; font-size:13px; line-height:18px;}
    .legend i {margin-right:6px;}
    .dayRow {display:flex; justify-content:flex-start; flex-wrap:wrap;}
    .dayCol {flex:1; padding:5px; min-width:160px; border:1px solid #ccc; margin:4px; border-radius:5px; background:#fafafa;}
    .dayCol h4 {text-align:center; margin:0 0 5px 0;}
    a {color:#0077cc;}
  </style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <button class="tablink active" onclick="openTab('mapTab',this)">Map</button>
  <button class="tablink" onclick="openTab('planTab',this)">Plan</button>
</div>

<!-- Tab contents -->
<div id="mapTab" class="tabcontent active">
  <div id="map"></div>
  <div class="controls">
    <label><b>Plan:</b></label><br>
    <select id="planSelect">
      <option value="A">Plan A (Lyon + Beaujolais)</option>
      <option value="B">Plan B (Lyon only)</option>
    </select><br>
    <label><b>Day:</b></label><br>
    <select id="daySelect">
      <option value="all">All Days</option>
      <option value="day1">Day 1</option>
      <option value="day2">Day 2</option>
      <option value="day3">Day 3</option>
      <option value="day4">Day 4</option>
      <option value="day5">Day 5</option>
    </select>
  </div>
</div>

<div id="planTab" class="tabcontent">
  <div id="plan">
    <h3>Trip Plan</h3>
    <div id="planDetails"></div>
  </div>
</div>

<script>
// Tabs
function openTab(tabName,elm){
  document.querySelectorAll('.tabcontent').forEach(c=>c.classList.remove('active'));
  document.querySelectorAll('.tablink').forEach(b=>b.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  elm.classList.add('active');

  // Fix for iPhone Safari
  if(tabName === 'mapTab'){
    setTimeout(()=>{ map.invalidateSize(); }, 200);
  }
  if(tabName === 'planTab'){
    refreshMap();
  }
}

// Map
var map=L.map("map",{center:[45.764,4.8357],zoom:13});
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
 {attribution:"¬© OpenStreetMap contributors"}).addTo(map);

// Icons per category
function getIcon(category, color){
  let icons={
    museum:"university",
    church:"institution",
    restaurant:"cutlery",
    winery:"glass",
    walk:"tree",
    market:"shopping-basket",
    landmark:"map-marker",
    home:"home"
  };
  return L.AwesomeMarkers.icon({
    icon:icons[category]||"map-marker",
    prefix:"fa",
    markerColor:color,
    iconColor:"white"
  });
}

// Colors per day
const dayColors={day1:"red",day2:"blue",day3:"green",day4:"orange",day5:"purple"};

// Plans dataset
const plans={
 A:{ // With Beaujolais
  day1:[
    {lat:45.767, lng:4.822, name:"Basilica of Fourvi√®re", category:"church", duration:"~1.5h"},
    {lat:45.761, lng:4.827, name:"Vieux Lyon (Old Town)", category:"walk", duration:"~2h"},
    {lat:45.762, lng:4.822, name:"Mus√©e des Beaux-Arts", category:"museum", duration:"~2h (book online)", website:"https://mba-lyon.fr"},
    {lat:45.7692,lng:4.8344,name:"Le Bouchon des Filles", category:"restaurant", duration:"Dinner ~1.5h", phone:"+33 4 78 30 40 44", instagram:"https://www.instagram.com/bouchondesfilles"}
  ],
  day2:[
    {lat:45.7515,lng:4.8288,name:"Le Po√™lon d‚ÄôOr", category:"restaurant", duration:"Lunch 1h", phone:"+33 4 78 37 65 60"},
    {lat:45.7626,lng:4.835,name:"Presqu‚Äô√Æle Stroll", category:"walk", duration:"~2h"},
    {lat:45.7625,lng:4.8272,name:"Les Adrets", category:"restaurant", duration:"Dinner 1.5h", phone:"+33 4 78 38 24 30"}
  ],
  day3:[
    {lat:45.733,lng:4.82,name:"Mus√©e des Confluences", category:"museum", duration:"~2.5h (book tickets)", website:"https://www.museedesconfluences.fr"},
    {lat:45.7761,lng:4.8272,name:"Croix-Rousse District", category:"walk", duration:"~2h"},
    {lat:45.7482,lng:4.8258,name:"Brasserie Georges", category:"restaurant", duration:"Dinner 2h", phone:"+33 4 72 56 54 54", website:"https://brasseriegeorges.com"}
  ],
  day4:[
    {lat:46.203,lng:4.706,name:"Ch√¢teau de Pizay Winery", category:"winery", duration:"~3h (reserve)", phone:"+33 4 74 66 26 10", website:"https://www.chateau-pizay.com"},
    {lat:46.2078,lng:4.7139,name:"Domaine des Nugues", category:"winery", duration:"~2h (reserve)", phone:"+33 4 74 69 95 64"}
  ],
  day5:[
    {lat:45.784,lng:4.85,name:"Parc de la T√™te d‚ÄôOr", category:"walk", duration:"~1.5h"},
    {lat:45.764,lng:4.8357,name:"Transfer to Airport", category:"landmark", duration:"~1h"}
  ]
 },
 B:{ // Lyon only
  day1:[
    {lat:45.767, lng:4.822, name:"Basilica of Fourvi√®re", category:"church", duration:"~1.5h"},
    {lat:45.761, lng:4.827, name:"Vieux Lyon (Old Town)", category:"walk", duration:"~2h"},
    {lat:45.762, lng:4.822, name:"Mus√©e des Beaux-Arts", category:"museum", duration:"~2h (book online)", website:"https://mba-lyon.fr"},
    {lat:45.7692,lng:4.8344,name:"Le Bouchon des Filles", category:"restaurant", duration:"Dinner ~1.5h", phone:"+33 4 78 30 40 44", instagram:"https://www.instagram.com/bouchondesfilles"}
  ],
  day2:[
    {lat:45.7515,lng:4.8288,name:"Le Po√™lon d‚ÄôOr", category:"restaurant", duration:"Lunch 1h", phone:"+33 4 78 37 65 60"},
    {lat:45.733,lng:4.82,name:"Mus√©e des Confluences", category:"museum", duration:"~2.5h (book tickets)", website:"https://www.museedesconfluences.fr"},
    {lat:45.7626,lng:4.835,name:"Presqu‚Äô√Æle Stroll", category:"walk", duration:"~1.5h"},
    {lat:45.7625,lng:4.8272,name:"Les Adrets", category:"restaurant", duration:"Dinner 1.5h", phone:"+33 4 78 38 24 30"}
  ],
  day3:[
    {lat:45.7761,lng:4.8272,name:"Croix-Rousse District", category:"walk", duration:"~2h"},
    {lat:45.7626,lng:4.8274,name:"Les Halles Paul Bocuse", category:"market", duration:"~1.5h", website:"https://www.hallesdelyon.com"},
    {lat:45.7482,lng:4.8258,name:"Brasserie Georges", category:"restaurant", duration:"Dinner 2h", phone:"+33 4 72 56 54 54", website:"https://brasseriegeorges.com"}
  ],
  day4:[
    {lat:45.761,lng:4.8347,name:"Mus√©e Miniature & Cin√©ma", category:"museum", duration:"~2h", website:"https://www.museeminiatureetcinema.fr"},
    {lat:45.784,lng:4.85,name:"Parc de la T√™te d‚ÄôOr", category:"walk", duration:"~2h"}
  ],
  day5:[
    {lat:45.764,lng:4.8357,name:"Morning boulangerie + shopping", category:"walk", duration:"~1h"},
    {lat:45.764,lng:4.8357,name:"Transfer to Airport", category:"landmark", duration:"~1h"}
  ]
 }
};

// State
let currentPlan="A", currentDay="all", markers=[];

// Refresh Map + Plan
function refreshMap(){
 markers.forEach(m=>map.removeLayer(m)); markers=[];
 let selectedPlan=plans[currentPlan];
 for(let d in selectedPlan){
   if(currentDay==="all"||currentDay===d){
     selectedPlan[d].forEach(p=>{
       let m=L.marker([p.lat,p.lng],{icon:getIcon(p.category,dayColors[d])}).addTo(map);
       let popup="<b>"+p.name+"</b><br>"+p.duration;
       if(p.phone) popup+="<br>üìû <a href='tel:"+p.phone+"'>"+p.phone+"</a>";
       if(p.website) popup+="<br>üåê <a href='"+p.website+"' target='_blank'>Website</a>";
       if(p.instagram) popup+="<br>üì∑ <a href='"+p.instagram+"' target='_blank'>Instagram</a>";
       m.bindPopup(popup); markers.push(m);
     });
   }
 }
 // Update text plan
 let planDiv=document.getElementById("planDetails"); planDiv.innerHTML="";
 let row=document.createElement("div"); row.className="dayRow";
 for(let d in selectedPlan){
   if(currentDay==="all"||currentDay===d){
     let col=document.createElement("div"); col.className="dayCol";
     col.innerHTML="<h4>"+d.replace("day","Day ")+"</h4><ul>";
     selectedPlan[d].forEach(p=>{
       col.innerHTML+="<li>"+p.name+" ‚Äì "+p.duration+"</li>";
     });
     col.innerHTML+="</ul>";
     row.appendChild(col);
   }
 }
 planDiv.appendChild(row);
}

// Event listeners
document.getElementById("planSelect").addEventListener("change",e=>{currentPlan=e.target.value;refreshMap();});
document.getElementById("daySelect").addEventListener("change",e=>{currentDay=e.target.value;refreshMap();});

// Add home fixed pin
let home=L.marker([45.7678,4.832],{icon:getIcon("home","cadetblue")}).addTo(map);
home.bindPopup("<b>Your Home</b><br>12 Rue Burdeau, Lyon");

// Legend
var legend=L.control({position:"bottomright"});
legend.onAdd=function(){
 let div=L.DomUtil.create("div","legend");
 div.innerHTML="<b>Legend</b><br>";
 div.innerHTML+="<u>Days</u><br>";
 div.innerHTML+='<i style="color:red" class="fa fa-circle"></i> Day 1<br>';
 div.innerHTML+='<i style="color:blue" class="fa fa-circle"></i> Day 2<br>';
 div.innerHTML+='<i style="color:green" class="fa fa-circle"></i> Day 3<br>';
 div.innerHTML+='<i style="color:orange" class="fa fa-circle"></i> Day 4<br>';
 div.innerHTML+='<i style="color:purple" class="fa fa-circle"></i> Day 5<br><hr>';
 div.innerHTML+="<u>Categories</u><br>";
 div.innerHTML+='<i class="fa fa-university"></i> Museum<br>';
 div.innerHTML+='<i class="fa fa-institution"></i> Church<br>';
 div.innerHTML+='<i class="fa fa-cutlery"></i> Restaurant<br>';
 div.innerHTML+='<i class="fa fa-glass"></i> Winery<br>';
 div.innerHTML+='<i class="fa fa-tree"></i> Walk/Park<br>';
 div.innerHTML+='<i class="fa fa-shopping-basket"></i> Market<br>';
 div.innerHTML+='<i class="fa fa-map-marker"></i> Landmark<br>';
 div.innerHTML+='<i class="fa fa-home"></i> Home<br>';
 return div;
};
legend.addTo(map);

// Init
refreshMap();
</script>
</body>
</html>
